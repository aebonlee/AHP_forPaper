import React, { useState, useEffect } from 'react';
import Card from '../common/Card';
import Button from '../common/Button';
import CriteriaManagement from './CriteriaManagement';
import AlternativeManagement from './AlternativeManagement';
import EvaluatorAssignment from './EvaluatorAssignment';
import EnhancedEvaluatorManagement from './EnhancedEvaluatorManagement';
import SurveyLinkManager from './SurveyLinkManager';
import ModelFinalization from './ModelFinalization';
import WorkflowStageIndicator, { WorkflowStage } from '../workflow/WorkflowStageIndicator';
import { EvaluationMode } from '../evaluation/EvaluationModeSelector';
import PaymentSystem from '../payment/PaymentSystem';
import WorkshopManagement from '../workshop/WorkshopManagement';
import DecisionSupportSystem from '../decision/DecisionSupportSystem';
import PaperManagement from '../paper/PaperManagement';
import ProjectSelector from '../project/ProjectSelector';
import SurveyFormBuilder from '../survey/SurveyFormBuilder';
import dataService from '../../services/dataService';
import type { ProjectData } from '../../services/dataService';

interface PersonalServiceProps {
  user: {
    id: string;
    first_name: string;
    last_name: string;
    email: string;
    role: 'super_admin' | 'admin' | 'evaluator';
    admin_type?: 'super' | 'personal';
  };
  activeTab?: string;
  onTabChange?: (tab: string) => void;
}

interface UserProject extends Omit<ProjectData, 'evaluation_method'> {
  evaluator_count?: number;
  completion_rate?: number;
  criteria_count: number;
  alternatives_count: number;
  last_modified: string;
  evaluation_method: 'pairwise' | 'direct' | 'mixed'; // Î†àÍ±∞Ïãú Ìò∏ÌôòÏÑ±
}


const PersonalServiceDashboard: React.FC<PersonalServiceProps> = ({ 
  user, 
  activeTab: externalActiveTab,
  onTabChange: externalOnTabChange
}) => {
  const [projects, setProjects] = useState<UserProject[]>([]);
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const [activeProject, setActiveProject] = useState<string | null>(null);
  const [currentStep, setCurrentStep] = useState<'overview' | 'projects' | 'criteria' | 'alternatives' | 'evaluators' | 'finalize'>('overview');
  const [isProjectFormOpen, setIsProjectFormOpen] = useState(false);
  const [editingProject, setEditingProject] = useState<UserProject | null>(null);
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const [loading, setLoading] = useState(false);
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const [error, setError] = useState<string | null>(null);
  const [projectForm, setProjectForm] = useState({
    title: '',
    description: '',
    objective: '',
    evaluation_method: 'pairwise' as 'pairwise' | 'direct' | 'mixed',
    evaluation_mode: 'practical' as EvaluationMode,
    workflow_stage: 'creating' as WorkflowStage
  });
  const [showProjectSelector, setShowProjectSelector] = useState(false);
  const [projectSelectorConfig, setProjectSelectorConfig] = useState<{
    title: string;
    description: string;
    nextAction: string;
  } | null>(null);
  const [activeMenu, setActiveMenu] = useState<'dashboard' | 'projects' | 'creation' | 'model-builder' | 'evaluators' | 'survey-links' | 'monitoring' | 'analysis' | 'paper' | 'export' | 'workshop' | 'decision-support' | 'settings' | 'payment' | 'demographic-survey'>(
    externalActiveTab === 'personal-service' ? 'dashboard' :
    externalActiveTab === 'demographic-survey' ? 'demographic-survey' :
    externalActiveTab === 'my-projects' ? 'projects' :
    externalActiveTab === 'project-creation' ? 'creation' :
    externalActiveTab === 'model-builder' ? 'model-builder' :
    externalActiveTab === 'evaluator-management' ? 'evaluators' :
    externalActiveTab === 'progress-monitoring' ? 'monitoring' :
    externalActiveTab === 'results-analysis' ? 'analysis' :
    externalActiveTab === 'paper-management' ? 'paper' :
    externalActiveTab === 'export-reports' ? 'export' :
    externalActiveTab === 'workshop-management' ? 'workshop' :
    externalActiveTab === 'decision-support-system' ? 'decision-support' :
    externalActiveTab === 'personal-settings' ? 'settings' :
    'dashboard'
  );
  const [selectedProjectId, setSelectedProjectId] = useState<string>('');
  const [projectTemplate, setProjectTemplate] = useState<'blank' | 'business' | 'technical' | 'academic'>('blank');
  
  // Project management UI states
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState<'all' | 'draft' | 'active' | 'completed'>('all');
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
  const [sortBy, setSortBy] = useState<'name' | 'date' | 'progress' | 'status'>('date');

  const projectTemplates = {
    blank: { name: 'Îπà ÌîÑÎ°úÏ†ùÌä∏', desc: 'Ï≤òÏùåÎ∂ÄÌÑ∞ ÏÑ§Ï†ï' },
    business: { name: 'ÎπÑÏ¶àÎãàÏä§ Í≤∞Ï†ï', desc: 'Í≤ΩÏòÅ ÏùòÏÇ¨Í≤∞Ï†ï ÌÖúÌîåÎ¶ø' },
    technical: { name: 'Í∏∞Ïà† ÏÑ†ÌÉù', desc: 'Í∏∞Ïà† ÎåÄÏïà ÎπÑÍµê ÌÖúÌîåÎßø' },
    academic: { name: 'Ïó∞Íµ¨ Î∂ÑÏÑù', desc: 'ÌïôÏà† Ïó∞Íµ¨Ïö© ÌÖúÌîåÎßø' }
  };

  // Ïô∏Î∂ÄÏóêÏÑú activeTabÏù¥ Î≥ÄÍ≤ΩÎêòÎ©¥ ÎÇ¥Î∂Ä activeMenuÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
  useEffect(() => {
    if (externalActiveTab) {
      const menuMap: Record<string, string> = {
        'personal-service': 'dashboard',
        'demographic-survey': 'demographic-survey',
        'my-projects': 'projects',
        'project-creation': 'creation',
        'model-builder': 'model-builder',
        'evaluator-management': 'evaluators',
        'progress-monitoring': 'monitoring',
        'results-analysis': 'analysis',
        'paper-management': 'paper',
        'export-reports': 'export',
        'workshop-management': 'workshop',
        'decision-support-system': 'decision-support',
        'personal-settings': 'settings'
      };
      const mappedMenu = menuMap[externalActiveTab] || 'dashboard';
      setActiveMenu(mappedMenu as any);
    }
  }, [externalActiveTab]);

  useEffect(() => {
    loadProjects();
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // ÌôúÏÑ± Î©îÎâ¥Í∞Ä Î≥ÄÍ≤ΩÎê† Îïå ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ†® ÌÉ≠Ïù¥Î©¥ Îç∞Ïù¥ÌÑ∞Î•º Îã§Ïãú Î°úÎìú
  useEffect(() => {
    if (activeMenu === 'projects' || activeMenu === 'dashboard') {
      loadProjects();
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeMenu]);

  const loadProjects = async () => {
    setLoading(true);
    setError(null);
    
    try {
      console.log('üìä ÌÜµÌï© Îç∞Ïù¥ÌÑ∞ ÏÑúÎπÑÏä§ÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú');
      
      // ÌÜµÌï© Îç∞Ïù¥ÌÑ∞ ÏÑúÎπÑÏä§ ÏÇ¨Ïö© (ÏûêÎèôÏúºÎ°ú Ïò®ÎùºÏù∏/Ïò§ÌîÑÎùºÏù∏ Î™®Îìú Ï≤òÎ¶¨)
      const projectsData = await dataService.getProjects();
      
      // ProjectDataÎ•º UserProjectÎ°ú Î≥ÄÌôò
      const convertedProjects: UserProject[] = projectsData.map((project: ProjectData) => ({
        ...project,
        evaluator_count: 0, // TODO: ÌèâÍ∞ÄÏûê Ïàò Í≥ÑÏÇ∞
        completion_rate: 0, // TODO: Ïã§Ï†ú ÏôÑÎ£åÏú® Í≥ÑÏÇ∞
        last_modified: project.updated_at || project.created_at || new Date().toISOString(),
        evaluation_method: (project.evaluation_mode || 'pairwise') as 'pairwise' | 'direct' | 'mixed',
        criteria_count: project.criteria_count || 0,
        alternatives_count: project.alternatives_count || 0
      }));
      
      setProjects(convertedProjects);
      console.log(`‚úÖ ÌîÑÎ°úÏ†ùÌä∏ ${convertedProjects.length}Í∞ú Î°úÎìú ÏôÑÎ£å`);
    } catch (error) {
      console.error('‚ùå ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú Ïã§Ìå®:', error);
      setError('ÌîÑÎ°úÏ†ùÌä∏Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  const handleTabChange = (newMenu: typeof activeMenu) => {
    setActiveMenu(newMenu);
    
    // Ïô∏Î∂Ä ÌÉ≠ Î≥ÄÍ≤Ω ÏΩúÎ∞± Ìò∏Ï∂ú
    if (externalOnTabChange) {
      const reverseMenuMap: Record<string, string> = {
        'dashboard': 'personal-service',
        'demographic-survey': 'demographic-survey',
        'projects': 'my-projects',
        'creation': 'project-creation',
        'model-builder': 'model-builder',
        'evaluators': 'evaluator-management',
        'monitoring': 'progress-monitoring',
        'analysis': 'results-analysis',
        'paper': 'paper-management',
        'export': 'export-reports',
        'workshop': 'workshop-management',
        'decision-support': 'decision-support-system',
        'settings': 'personal-settings'
      };
      const externalTab = reverseMenuMap[newMenu] || 'personal-service';
      externalOnTabChange(externalTab);
    }
  };

  const handleProjectAction = (actionType: 'model-builder' | 'evaluators' | 'monitoring' | 'analysis', project?: UserProject) => {
    if (project) {
      setActiveProject(project.id || '');
      setSelectedProjectId(project.id || '');
    }
    
    if (actionType === 'model-builder') {
      setProjectSelectorConfig({
        title: 'Î™®Îç∏ Íµ¨Ï∂ïÌï† ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù',
        description: 'Í∏∞Ï§ÄÍ≥º ÎåÄÏïàÏùÑ ÏÑ§Ï†ïÌï† ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.',
        nextAction: 'model-builder'
      });
      setShowProjectSelector(true);
    } else {
      setActiveMenu(actionType);
    }
  };

  const formatDate = (dateString: string) => {
    try {
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    } catch {
      return 'Ïïå Ïàò ÏóÜÏùå';
    }
  };

  const getStatusColor = (status?: string) => {
    switch (status) {
      case 'active': return 'bg-green-100 text-green-800';
      case 'completed': return 'bg-blue-100 text-blue-800';
      case 'draft': return 'bg-gray-100 text-gray-800';
      default: return 'bg-yellow-100 text-yellow-800';
    }
  };

  const getStatusText = (status?: string) => {
    switch (status) {
      case 'active': return 'ÏßÑÌñâÏ§ë';
      case 'completed': return 'ÏôÑÎ£å';
      case 'draft': return 'Ï¥àÏïà';
      default: return 'ÎåÄÍ∏∞Ï§ë';
    }
  };

  // Ïù∏Íµ¨ÌÜµÍ≥ÑÌïôÏ†Å ÏÑ§Î¨∏Ï°∞ÏÇ¨ Ïª®ÌÖêÏ∏† Î†åÎçîÎßÅ
  if (activeMenu === 'demographic-survey') {
    return (
      <div className="max-w-6xl mx-auto space-y-6 p-6">
        <SurveyFormBuilder 
          onSave={(questions) => {
            console.log('ÏÑ§Î¨∏ Ìèº Ï†ÄÏû•:', questions);
            alert('ÏÑ§Î¨∏ ÌèºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            handleTabChange('dashboard');
          }}
          onCancel={() => handleTabChange('dashboard')}
        />
      </div>
    );
  }

  // Í∏∞ÌÉÄ Î©îÎâ¥ Ïª®ÌÖêÏ∏† Î†åÎçîÎßÅ
  const renderMenuContent = () => {
    switch (activeMenu) {
      case 'projects':
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h2 className="text-2xl font-bold text-gray-900">ÎÇ¥ ÌîÑÎ°úÏ†ùÌä∏</h2>
              <Button
                onClick={() => setActiveMenu('creation')}
                variant="primary"
                size="md"
                className="bg-blue-600 hover:bg-blue-700"
              >
                ‚ûï ÏÉà ÌîÑÎ°úÏ†ùÌä∏
              </Button>
            </div>
            
            {/* ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù */}
            <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {projects.map((project) => (
                <Card key={project.id} className="hover:shadow-lg transition-shadow">
                  <div className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <h3 className="font-semibold text-lg text-gray-900 line-clamp-1">
                        {project.title}
                      </h3>
                      <span className={`px-2 py-1 text-xs rounded-full ${getStatusColor(project.status)}`}>
                        {getStatusText(project.status)}
                      </span>
                    </div>
                    
                    <p className="text-gray-600 text-sm mb-4 line-clamp-2">
                      {project.description || 'ÏÑ§Î™Ö ÏóÜÏùå'}
                    </p>
                    
                    <div className="space-y-2 mb-4">
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-500">Í∏∞Ï§Ä</span>
                        <span className="font-medium">{project.criteria_count}Í∞ú</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-500">ÎåÄÏïà</span>
                        <span className="font-medium">{project.alternatives_count}Í∞ú</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-500">ÏàòÏ†ïÏùº</span>
                        <span className="font-medium">{formatDate(project.last_modified)}</span>
                      </div>
                    </div>
                    
                    <div className="flex space-x-2">
                      <Button
                        onClick={() => handleProjectAction('model-builder', project)}
                        variant="outline"
                        size="sm"
                        className="flex-1"
                      >
                        üèóÔ∏è Ìé∏Ïßë
                      </Button>
                      <Button
                        onClick={() => handleProjectAction('analysis', project)}
                        variant="outline"
                        size="sm"
                        className="flex-1"
                      >
                        üìä Î∂ÑÏÑù
                      </Button>
                    </div>
                  </div>
                </Card>
              ))}
            </div>
            
            {projects.length === 0 && (
              <div className="text-center py-12">
                <div className="text-6xl mb-4">üìã</div>
                <h3 className="text-xl font-medium text-gray-900 mb-2">ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§</h3>
                <p className="text-gray-500 mb-6">Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÉùÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî</p>
                <Button
                  onClick={() => setActiveMenu('creation')}
                  variant="primary"
                  size="md"
                >
                  ‚ûï ÏÉà ÌîÑÎ°úÏ†ùÌä∏ ÎßåÎì§Í∏∞
                </Button>
              </div>
            )}
          </div>
        );

      case 'creation':
        return (
          <div className="space-y-8">
            <div className="text-center">
              <h2 className="text-3xl font-bold text-gray-900 mb-4">ÏÉà ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ±</h2>
              <p className="text-gray-600 max-w-2xl mx-auto">
                AHP ÏùòÏÇ¨Í≤∞Ï†ï Î∂ÑÏÑùÏùÑ ÏúÑÌïú ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§. ÌÖúÌîåÎ¶øÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Îπà ÌîÑÎ°úÏ†ùÌä∏Î°ú ÏãúÏûëÌï† Ïàò ÏûàÏäµÎãàÎã§.
              </p>
            </div>
            
            {/* ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù */}
            <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
              {Object.entries(projectTemplates).map(([key, template]) => (
                <Card
                  key={key}
                  className={`cursor-pointer transition-all ${
                    projectTemplate === key 
                      ? 'ring-2 ring-blue-500 bg-blue-50' 
                      : 'hover:shadow-md'
                  }`}
                  onClick={() => setProjectTemplate(key as any)}
                >
                  <div className="p-6 text-center">
                    <div className="text-4xl mb-4">
                      {key === 'blank' ? 'üìÑ' : key === 'business' ? 'üíº' : key === 'technical' ? '‚öôÔ∏è' : 'üéì'}
                    </div>
                    <h3 className="font-semibold text-lg mb-2">{template.name}</h3>
                    <p className="text-gray-600 text-sm">{template.desc}</p>
                  </div>
                </Card>
              ))}
            </div>
            
            {/* ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥ ÏûÖÎ†• */}
            <Card>
              <div className="p-6 space-y-6">
                <h3 className="text-xl font-semibold">ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥</h3>
                
                <div className="grid gap-6 md:grid-cols-2">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ÌîÑÎ°úÏ†ùÌä∏ Ï†úÎ™© *
                    </label>
                    <input
                      type="text"
                      value={projectForm.title}
                      onChange={(e) => setProjectForm(prev => ({ ...prev, title: e.target.value }))}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Ïòà: Ïã†Ï†úÌíà Í∞úÎ∞ú Ï†ÑÎûµ ÏÑ†ÌÉù"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ÌèâÍ∞Ä Î∞©Î≤ï
                    </label>
                    <select
                      value={projectForm.evaluation_method}
                      onChange={(e) => setProjectForm(prev => ({ ...prev, evaluation_method: e.target.value as any }))}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="pairwise">ÏåçÎåÄÎπÑÍµê</option>
                      <option value="direct">ÏßÅÏ†ëÏûÖÎ†•</option>
                      <option value="mixed">ÌòºÌï©Î∞©Ïãù</option>
                    </select>
                  </div>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Î™Ö
                  </label>
                  <textarea
                    value={projectForm.description}
                    onChange={(e) => setProjectForm(prev => ({ ...prev, description: e.target.value }))}
                    rows={3}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                    placeholder="ÌîÑÎ°úÏ†ùÌä∏Ïùò Î™©Ï†ÅÍ≥º Î∞∞Í≤ΩÏùÑ ÏÑ§Î™ÖÌï¥Ï£ºÏÑ∏Ïöî"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    ÏùòÏÇ¨Í≤∞Ï†ï Î™©Ìëú
                  </label>
                  <input
                    type="text"
                    value={projectForm.objective}
                    onChange={(e) => setProjectForm(prev => ({ ...prev, objective: e.target.value }))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Ïòà: Í∞ÄÏû• Ï†ÅÌï©Ìïú ÎßàÏºÄÌåÖ Ï†ÑÎûµÏùÑ ÏÑ†ÌÉùÌïúÎã§"
                  />
                </div>
                
                <div className="flex justify-end space-x-4 pt-4">
                  <Button
                    onClick={() => setActiveMenu('dashboard')}
                    variant="outline"
                    size="md"
                  >
                    Ï∑®ÏÜå
                  </Button>
                  <Button
                    onClick={() => {
                      // TODO: ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ± Î°úÏßÅ
                      alert('ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                      setActiveMenu('projects');
                    }}
                    variant="primary"
                    size="md"
                    disabled={!projectForm.title.trim()}
                  >
                    ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ±
                  </Button>
                </div>
              </div>
            </Card>
          </div>
        );

      case 'model-builder':
        return (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <h2 className="text-2xl font-bold text-gray-900">Î™®Îç∏ Íµ¨Ï∂ï</h2>
              <Button onClick={() => setActiveMenu('projects')} variant="outline">
                ‚Üê ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù
              </Button>
            </div>
            
            <WorkflowStageIndicator 
              currentStage={currentStep as WorkflowStage}
            />
            
            {currentStep === 'criteria' && (
              <CriteriaManagement 
                projectId={selectedProjectId}
                onComplete={() => setCurrentStep('alternatives')}
              />
            )}
            
            {currentStep === 'alternatives' && (
              <AlternativeManagement 
                projectId={selectedProjectId}
                onComplete={() => setCurrentStep('evaluators')}
              />
            )}
            
            {currentStep === 'evaluators' && (
              <EvaluatorAssignment 
                projectId={selectedProjectId}
                onComplete={() => setCurrentStep('finalize')}
              />
            )}
            
            {currentStep === 'finalize' && (
              <ModelFinalization 
                projectId={selectedProjectId}
                onFinalize={() => setActiveMenu('monitoring')}
                isReadyToFinalize={true}
              />
            )}
          </div>
        );

      case 'evaluators':
        return (
          <EnhancedEvaluatorManagement 
            projectId={selectedProjectId}
          />
        );

      case 'survey-links':
        return (
          <SurveyLinkManager 
            projectId={selectedProjectId}
          />
        );

      case 'analysis':
        return (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <h2 className="text-2xl font-bold text-gray-900">Í≤∞Í≥º Î∂ÑÏÑù</h2>
              <Button onClick={() => setActiveMenu('projects')} variant="outline">
                ‚Üê ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù
              </Button>
            </div>
            <div className="text-center py-12">
              <div className="text-6xl mb-4">üìä</div>
              <h3 className="text-xl font-medium text-gray-900 mb-2">Í≤∞Í≥º Î∂ÑÏÑù</h3>
              <p className="text-gray-500">Î∂ÑÏÑùÌï† ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
            </div>
          </div>
        );

      case 'paper':
        return <PaperManagement />;

      case 'workshop':
        return <WorkshopManagement />;

      case 'decision-support':
        return <DecisionSupportSystem />;

      case 'export':
        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-gray-900">Î≥¥Í≥†ÏÑú ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h2>
            <div className="text-center py-12">
              <div className="text-6xl mb-4">üì§</div>
              <h3 className="text-xl font-medium text-gray-900 mb-2">Î≥¥Í≥†ÏÑú ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h3>
              <p className="text-gray-500">ÎÇ¥Î≥¥ÎÇº ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
            </div>
          </div>
        );

      case 'settings':
        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-gray-900">Í∞úÏù∏ ÏÑ§Ï†ï</h2>
            
            <Card>
              <div className="p-6">
                <h3 className="text-lg font-semibold mb-4">Í≥ÑÏ†ï Ï†ïÎ≥¥</h3>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Ïù¥Î¶Ñ</label>
                    <div className="mt-1 p-2 bg-gray-50 rounded-md">
                      {user.first_name} {user.last_name}
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Ïù¥Î©îÏùº</label>
                    <div className="mt-1 p-2 bg-gray-50 rounded-md">
                      {user.email}
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Ïó≠Ìï†</label>
                    <div className="mt-1 p-2 bg-gray-50 rounded-md">
                      {user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÌèâÍ∞ÄÏûê'}
                    </div>
                  </div>
                </div>
              </div>
            </Card>
          </div>
        );

      case 'payment':
        return <PaymentSystem />;

      default:
        return (
          <div className="space-y-8">
            {/* ÎåÄÏãúÎ≥¥Îìú Ìó§Îçî */}
            <div className="text-center space-y-4">
              <h1 className="text-4xl font-bold text-gray-900">
                ÏïàÎÖïÌïòÏÑ∏Ïöî, <span className="text-blue-600">{user.first_name} {user.last_name}</span>Îãò
              </h1>
              <div className="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full">
                <span className="font-medium">Premium Member</span>
              </div>
              <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                Ï†ÑÎ¨∏Ï†ÅÏù∏ AHP ÏùòÏÇ¨Í≤∞Ï†ï Î∂ÑÏÑùÏúºÎ°ú Î≥µÏû°Ìïú Î¨∏Ï†úÎ•º Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Ìï¥Í≤∞Ìï¥Î≥¥ÏÑ∏Ïöî
              </p>
            </div>

            {/* ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô© */}
            <div className="grid gap-6 md:grid-cols-3">
              <Card className="text-center p-6">
                <div className="text-4xl mb-4">üìã</div>
                <div className="text-3xl font-bold text-gray-900 mb-2">{projects.length}</div>
                <div className="text-gray-600">Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏</div>
              </Card>
              
              <Card className="text-center p-6">
                <div className="text-4xl mb-4">üîÑ</div>
                <div className="text-3xl font-bold text-gray-900 mb-2">
                  {projects.filter(p => p.status === 'active').length}
                </div>
                <div className="text-gray-600">ÏßÑÌñâÏ§ë</div>
              </Card>
              
              <Card className="text-center p-6">
                <div className="text-4xl mb-4">‚úÖ</div>
                <div className="text-3xl font-bold text-gray-900 mb-2">
                  {projects.filter(p => p.status === 'completed').length}
                </div>
                <div className="text-gray-600">ÏôÑÎ£åÎê®</div>
              </Card>
            </div>

            {/* Îπ†Î•∏ ÏûëÏóÖ */}
            <Card>
              <div className="p-6">
                <h3 className="text-xl font-semibold mb-6">Îπ†Î•∏ ÏûëÏóÖ</h3>
                <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                  <Button
                    onClick={() => setActiveMenu('creation')}
                    variant="outline"
                    size="lg"
                    className="h-20 flex flex-col items-center justify-center space-y-2"
                  >
                    <span className="text-2xl">‚ûï</span>
                    <span>ÏÉà ÌîÑÎ°úÏ†ùÌä∏</span>
                  </Button>
                  
                  <Button
                    onClick={() => setActiveMenu('projects')}
                    variant="outline"
                    size="lg"
                    className="h-20 flex flex-col items-center justify-center space-y-2"
                  >
                    <span className="text-2xl">üìÇ</span>
                    <span>ÎÇ¥ ÌîÑÎ°úÏ†ùÌä∏</span>
                  </Button>
                  
                  <Button
                    onClick={() => setActiveMenu('analysis')}
                    variant="outline"
                    size="lg"
                    className="h-20 flex flex-col items-center justify-center space-y-2"
                  >
                    <span className="text-2xl">üìä</span>
                    <span>Í≤∞Í≥º Î∂ÑÏÑù</span>
                  </Button>
                  
                  <Button
                    onClick={() => setActiveMenu('demographic-survey')}
                    variant="outline"
                    size="lg"
                    className="h-20 flex flex-col items-center justify-center space-y-2"
                  >
                    <span className="text-2xl">üìã</span>
                    <span>ÏÑ§Î¨∏ ÏÉùÏÑ±</span>
                  </Button>
                </div>
              </div>
            </Card>

            {/* ÏµúÍ∑º ÌîÑÎ°úÏ†ùÌä∏ */}
            {projects.length > 0 && (
              <Card>
                <div className="p-6">
                  <div className="flex items-center justify-between mb-6">
                    <h3 className="text-xl font-semibold">ÏµúÍ∑º ÌîÑÎ°úÏ†ùÌä∏</h3>
                    <Button
                      onClick={() => setActiveMenu('projects')}
                      variant="ghost"
                      size="sm"
                    >
                      Ï†ÑÏ≤¥ Î≥¥Í∏∞ ‚Üí
                    </Button>
                  </div>
                  
                  <div className="grid gap-4 md:grid-cols-2">
                    {projects.slice(0, 4).map((project) => (
                      <div
                        key={project.id}
                        className="flex items-center space-x-4 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer"
                        onClick={() => handleProjectAction('model-builder', project)}
                      >
                        <div className="text-2xl">üìã</div>
                        <div className="flex-1 min-w-0">
                          <h4 className="font-medium text-gray-900 truncate">{project.title}</h4>
                          <p className="text-sm text-gray-500">
                            {formatDate(project.last_modified)}
                          </p>
                        </div>
                        <span className={`px-2 py-1 text-xs rounded-full ${getStatusColor(project.status)}`}>
                          {getStatusText(project.status)}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              </Card>
            )}
          </div>
        );
    }
  };

  return (
    <div className="max-w-6xl mx-auto space-y-6 p-6">
      {renderMenuContent()}
      
      {/* ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù Î™®Îã¨ */}
      {showProjectSelector && projectSelectorConfig && (
        <ProjectSelector
          title={projectSelectorConfig.title}
          description={projectSelectorConfig.description}
          onProjectSelect={(project) => {
            setSelectedProjectId(project.id || '');
            setActiveProject(project.id || '');
            setShowProjectSelector(false);
            setActiveMenu(projectSelectorConfig.nextAction as any);
          }}
          onCancel={() => {
            setShowProjectSelector(false);
            setProjectSelectorConfig(null);
          }}
        />
      )}
    </div>
  );
};

export default PersonalServiceDashboard;